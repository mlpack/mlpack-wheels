From a865a0aa18e463bb83a35095757bead7d2fd5ab0 Mon Sep 17 00:00:00 2001
From: Ryan Curtin <ryan@ratml.org>
Date: Thu, 3 Nov 2022 09:05:14 -0400
Subject: [PATCH] Some changes to make the compiled libraries smaller.

---
 src/mlpack/bindings/python/setup.py.in | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/src/mlpack/bindings/python/setup.py.in b/src/mlpack/bindings/python/setup.py.in
index aabd85a6fb..0debed692d 100644
--- a/src/mlpack/bindings/python/setup.py.in
+++ b/src/mlpack/bindings/python/setup.py.in
@@ -49,15 +49,22 @@ else:
   extra_cxx_flags = re.sub(' +', ' ', cxx_flags)
   cxx_flags += ' '
   cxx_flags += extra_cxx_flags
-  extra_args = ['-DBINDING_TYPE=BINDING_TYPE_PYX', '-std=c++14']
+  extra_args = ['-DBINDING_TYPE=BINDING_TYPE_PYX', '-std=c++17']
   if '${OpenMP_CXX_FLAGS}' != '':
     extra_args.append('${OpenMP_CXX_FLAGS}')
   if cxx_flags:
     extra_args.extend(cxx_flags.split(' '))
 
-  # Extra options for MSVC compiler.
   if platform.system() == 'Windows':
+    # Extra options for MSVC compiler.
     extra_args.extend(['/MD', '/O2', '/Ob2', '/DNDEBUG'])
+  elif platform.system() == 'Darwin':
+    # On OS X and Linux, we try to reduce the size of the generated libraries by
+    # removing debugging symbols and stripping.
+    extra_args.append('-g0')
+  else:
+    extra_args.append('-g0')
+    extra_link_args.append('--Wl,--strip-all')
 
   # This is used for parallel builds; CMake will set PYX_TO_BUILD accordingly.
   if module is not None:
-- 
2.37.2

